---
layout:     post
title:      Nodejs实战
subtitle:   chapter01：
date:       2023-09-10
author:     forwardZ
header-img: img/the-first.png
catalog: false
tags:
    - 服务端_Nodejs_数据库
---



## Chapter01：欢迎进入Node.js世界

目标：

1. Node.js是什么？
2. 服务端JavaScript
3. Node的异步和事件触发本质
4. Node为谁而生：DIRIT，
5. Node程序示例

官网上(http://www.nodejs.org)给Node下的定义是:“一个搭建在Chrome JavaScript运行时 上的平台，用于构建高速、可伸缩的网络程序。Node.js采用的事件驱动、非阻塞I/O模型，使它 既轻量又高效，并成为构建运行在分布式设备上的数据密集型实时程序的完美选择。”

重点概念：

1. 为什么JavaScript对服务端开发很重要;
2. 浏览器如何用JavaScript处理I/O;
3. Node在服务端如何处理I/O;
4. DIRT程序是什么意思，为什么适于用Node开发;
5. 几个基础的Node程序示例

### 一，构建于 JavaScript 之上

在服务器端编程，Node使用的是为Google Chrome提供动力的V8虚拟机。V8让Node在性能 上得到了巨大的提升，因为它去掉了中间环节，执行的不是字节码，用的也不是解释器，而是直 接编译成了本地机器码。Node在服务器端使用JavaScript还有其他好处。

* 开发人员用一种语言就能编写整个Web应用，代码可以在客户端和服务端中共享，比如在表单校验或游戏逻辑中使用同 样一段代码；
*   JSON是目前非常流行的数据交换格式，并且还是JavaScript原生的；
* 有些NoSQL数据库中用的就是JavaScript语言(比如CouchDB和MongoDB)，所以跟它们 简直是天作之合；
* JavaScript是一门编译目标语言，现在有很多可以编译成JavaScript的语言；
* Node用的虚拟机(V8)会紧跟ECMAScript标准；

### 二，异步和事件触发:浏览器

Node为服务端JavaScript提供了一个事件驱动的、异步的平台。它把JavaScript带到服务端中 的方式跟浏览器把JavaScript带到客户端的方式几乎一模一样。它们都是事件驱动(用事件轮询)和非阻塞的I/O处理(用异步 I/O)。

当浏览器中有I/O操作时，该操作会在事件轮询的外面执行(脚本执行的主顺序之外)，然后当这个I/O操作完成时，它会发出一个“事件”，会有一个函数(通常称作“回调”)处理它。这个I/O是异步的，并且不会“阻塞”脚本执行，事件轮询仍然可以响应页面上执行的其他 交互或请求。这样，浏览器可以对客户做出响应，并且可以处理页面上的很多交互动作。

### 三，异步和事件触发:服务器

传统服务器处理带IO阻塞采用多线程的方式。但程序内的线程管理会非常复杂。此外，当需要大量的线程处理很多并发的服务 器连接时，线程会消耗额外的操作系统资源。线程需要CPU和额外的RAM来做上下文切换。

NGINX(http://nginx.com/)，它跟Apache一样，是个HTTP服务器，但它用的不是带有阻塞I/O的多线程方式，而是带有异步I/O的事件轮询(就像浏览器和Node一样)。 因为这些设计上的选择，NGINX通常能处理更多的请求和客户端连接，它因此变成了响应能力 更强的解决方案。

在Node中，I/O几乎总是在主事件轮询之外进行，使得服务器可以一直处于高效并且随时能 够做出响应的状态，就像NGINX一样。这样进程就更加不会受I/O限制，因为I/O延迟不会拖垮服 务器，或者像在阻塞方式下那样占用很多资源。因此一些在服务器上曾经是重量级的操作，在 Node服务器上仍然可以是轻量级的。

这个混杂了事件驱动和异步的模型，加上几乎随处可用的JavaScript语言，帮我们打开了一个 精彩纷呈的数据密集型实时程序的世界。

### 四，DIRT 程序

Node所针对的应用程序有一个专门的简称:DIRT。它表示数据密集型实时(data-intensive real-time)程序。因为Node自身在I/O上非常轻量，它善于将数据从一个管道混排 或代理到另一个管道上，这能在处理大量请求时持有很多开放的连接，并且只占用一小部分内存。 它的设计目标是保证响应能力，跟浏览器一样。

实时程序，如白板在线协作、对临近公交车的实时精确定位、多人在线游戏，需要一个能够实时响应大量并发用户请求的平台来支撑它们。这正是Node所擅长的 领域，并且不仅限于Web程序，其他I/O负载比较重的程序也可以用到它。Browserling和Testling都是很好的DIRT程序范例。

### 五，默认 DIRT

Node从构建开始就有一个事件驱动和异步的模型。JavaScript从来没有过标准的I/O库，那是服务端语言的常见配置。对于JavaScript而言，这总是由“宿主”环境决定的。JavaScript最常见的宿主环境，就是浏览器，它是事件驱动和异步的。Node重新实现了宿主中那些常用的对象，尽量让浏览器和服务器保持一致，如：

* 计时器API(比如setTimeout);
* 控制台API(比如console.log)。

Node还有一组用来处理多种网络和文件I/O的核心模块。其中包括用于HTTP、TLS、HTTPS、 文件系统(POSIX)、数据报(UDP)和NET(TCP)的模块。第三方模块基于这些核心模块，针对常见 的问题进行了更高层的抽象。

注：Node是JavaScript程序的平台，相较Django，node更为底层。

Node程序示例：

* 1，一个简单的异步程序;
* 2，一个Hello World Web服务器

Node常被用来构建服务器。有了Node，创建各种服务器变得非常简单。如果你过去习惯于 把程序部署到服务器中运行(比如把PHP程序放到Apache HTTP服务器上)，可能会觉得这种方式 很怪异。在Node中，服务器和程序是一样的。

* 一个数据流的例子

Node在数据流和数据流动上也很强大。你可以把数据流看成特殊的数组，只不过数组中的数据分散在空间上，而数据流中的数据是分散在时间上的。通过将数据一块一块地传送，开发人员 可以每收到一块数据就开始处理，而不用等所有数据都到全了再做处理。有了对读取流的底层访问，程序 就可以边读取边处理，这要比等着所有数据都缓存到内存中再处理效率高得多。

Node在多个平台上均默认提供了DIRT方式，包括各种Windows和类UNIX系统。底层的I/O库(libuv)特意屏蔽了宿主操作系统的差异性，提供了统一的使用方式，如果需要的话，程序可 以在多个设备上轻松移植和运行。

### 六，小结

Node是:

* 构建在JavaScript之上的;
* 事件触发和异步的;
* 专为数据密集型实时程序设计的。









